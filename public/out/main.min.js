"use strict";

!function () {
  "use strict";

  const e = {
    formEl: document.querySelector(".nav-form__post"),
    inputEl: document.querySelector(".nav-form__input"),
    loginBtn: document.querySelector(".nav-auth__link"),
    listEl: document.querySelector(".main__list"),
    spinEl: document.querySelector(".spin")
  };
  console.clear(), e.formEl.addEventListener("submit", t => {
    t.preventDefault();
    const n = e.inputEl.value.trim();
    localStorage.setItem("_input", n), localStorage.getItem("_input"), n ? (async function (t) {
      await fetch("/", {
        method: "POST",
        headers: {
          "Content-type": "application/json"
        },
        body: JSON.stringify({
          track: t
        })
      }).then(e => e.json()).then(t => function (t) {
        null != t && e.spinEl.classList.add("visually-hidden");
        const n = t.tracks.items;
        let o = e.listEl;
        o.innerHTML = "", n.forEach((e, t) => {
          const n = document.createElement("li"),
            l = document.createElement("span"),
            r = document.createElement("img"),
            a = document.createElement("a");
          l.classList.add("main__span"), n.classList.add("main__item"), r.classList.add("main__img"), a.classList.add("main__link"), r.src = e.album.images[1].url, r.alt = e.album.name, a.href = e.external_urls.spotify, a.target = "_blank", a.rel = "noopener noreferrer nofollow", a.textContent = "".concat(e.name, " - ").concat(e.artists[0].name), l.textContent = "click", o.appendChild(n), a.appendChild(l), n.appendChild(r), n.appendChild(a);
        });
      }(t)).catch(e => console.error(e));
    }(n), e.spinEl.classList.remove("visually-hidden"), e.inputEl.placeholder = "Type to search...") : (e.inputEl.placeholder = "[error]", console.error("[error]")), e.formEl.reset();
  }), e.loginBtn.addEventListener("click", function () {
    window.open("/auth/twitch"), fetch("/auth/twitch/callback").then(e => e.json()).then(t => {
      console.log(t), !0 === t.login ? e.loginBtn.textContent = "Logout" : console.error("error");
    }).catch(e => {
      console.error("Error on authorization: ".concat(e.message));
    });
  });
}();