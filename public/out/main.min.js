"use strict";

!function () {
  "use strict";

  const e = {
    formEl: document.querySelector(".nav-form__post"),
    inputEl: document.querySelector(".nav-form__input"),
    loginBtn: document.querySelector(".nav-auth__link"),
    listEl: document.querySelector(".main__list"),
    spinEl: document.querySelector(".spin")
  };
  console.clear(), e.formEl.addEventListener("submit", t => {
    t.preventDefault();
    const n = e.inputEl.value.trim();
    localStorage.setItem("_input", n), localStorage.getItem("_input"), n ? (async function (t) {
      await fetch("/", {
        method: "POST",
        headers: {
          "Content-type": "application/json"
        },
        body: JSON.stringify({
          track: t
        })
      }).then(e => e.json()).then(t => function (t) {
        null != t && e.spinEl.classList.add("visually-hidden");
        const n = t.tracks.items;
        let o = e.listEl;
        o.innerHTML = "", n.forEach((e, t) => {
          const n = document.createElement("li"),
            i = document.createElement("span"),
            l = document.createElement("img"),
            r = document.createElement("a");
          i.classList.add("main__span"), n.classList.add("main__item"), l.classList.add("main__img"), r.classList.add("main__link"), l.src = e.album.images[1].url, l.alt = e.album.name, r.href = e.external_urls.spotify, r.target = "_blank", r.rel = "noopener noreferrer nofollow", r.textContent = "".concat(e.name, " - ").concat(e.artists[0].name), i.textContent = "click", o.appendChild(n), r.appendChild(i), n.appendChild(l), n.appendChild(r);
        });
      }(t)).catch(e => console.error(e));
    }(n), e.spinEl.classList.remove("visually-hidden"), e.inputEl.placeholder = "Type to search...") : (e.inputEl.placeholder = "[error]", console.error("[error]")), e.formEl.reset();
  }), e.loginBtn.addEventListener("click", function () {
    const t = window.open("/auth/twitch", "Twitch Auth", "width=600,height=600");
    window.addEventListener("message", function n(o) {
      if (o.origin === window.location.origin) {
        const i = o.data;
        console.log(i), !0 === i.login ? e.loginBtn.textContent = "Logout" : console.error("error"), t.close(), window.removeEventListener("message", n);
      }
    });
  });
}();