"use strict";(()=>{"use strict";function b(b){null!==b&&d.spinEl.classList.add("visually-hidden");const c=b?.tracks?.items||b?.items||b?.tracks||[];let e=d.listEl;e.innerHTML="",c.forEach(b=>{const c=document.createElement("li"),d=document.createElement("span"),f=document.createElement("img"),g=document.createElement("a");d.classList.add("main__span"),c.classList.add("main__item"),f.classList.add("main__img"),g.classList.add("main__link"),f.src=b.album.images[1]?.url||b.album.images[0]?.url||"",f.alt=b.album.name,g.href=b.external_urls.spotify,g.target="_blank",g.rel="noopener noreferrer nofollow",g.textContent=`${b.name} - ${b.artists[0].name}`,d.textContent="click",e.appendChild(c),g.appendChild(d),c.appendChild(f),c.appendChild(g),(b=>{const c=JSON.parse(localStorage.getItem(a))||[];c.some(a=>a.id===b.id)||(c.push(b),localStorage.setItem(a,JSON.stringify(c)))})(b)})}function c(){function b(){const b=i.matches;return g?void(f&&(f.style.display="none"),h?d.innerHTML=`\n        <img src="${h}"\n             alt="${g}"\n             style="\n               width:30px;\n               height:30px;\n               border-radius:50%;\n               margin-right:6px;\n               vertical-align:middle;\n             ">\n        <span style="font-weight:600;">\n          ${a||g}\n        </span>\n      `:d.textContent=a||g):(f&&(f.style.display="inline-flex"),void(d.textContent=b?"Login":"Login with Twitch"))}const c=document.querySelector(".nav-auth__link");if(c){const a="138, 43, 226";Object.assign(c.style,{transition:"transform 0.25s ease, box-shadow 0.25s ease, background-color 0.25s ease",willChange:"transform, box-shadow"}),c.addEventListener("mouseenter",()=>{c.style.transform="translateY(-1px)",c.style.boxShadow=`0 6px 16px rgba(${a}, 0.35)`}),c.addEventListener("mouseleave",()=>{c.style.transform="translateY(0)",c.style.boxShadow="none"}),c.addEventListener("mousedown",()=>{c.style.transform="translateY(1px)",c.style.boxShadow=`0 3px 8px rgba(${a}, 0.25)`}),c.addEventListener("mouseup",()=>{c.style.transform="translateY(-1px)",c.style.boxShadow=`0 6px 16px rgba(${a}, 0.35)`}),c.addEventListener("focus",()=>{c.style.boxShadow=`0 0 0 2px rgba(${a}, 0.45)`}),c.addEventListener("blur",()=>{c.style.boxShadow="none"})}const d=c.querySelector(".nav-auth__text"),f=c.querySelector(".nav-auth__icon"),g=localStorage.getItem("_username"),a=localStorage.getItem("_displayName"),h=localStorage.getItem("_profileImage"),i=window.matchMedia("(max-width: 1400px)");b(),i.addEventListener("change",b)}const a="savedTracks",d={loginTxt:document.querySelector(".nav-auth__text"),formEl:document.querySelector(".nav-form__post"),inputEl:document.querySelector(".nav-form__input"),loginBtn:document.querySelector(".nav-auth__link"),listEl:document.querySelector(".main__list"),spinEl:document.querySelector(".main__spin"),spinBackEl:document.querySelector(".main__spin-backdrop")},e=JSON.parse(localStorage.getItem("savedTracks"))||[];0<e.length&&b({tracks:{items:e}}),d.formEl.addEventListener("submit",async c=>{c.preventDefault();const e=d.inputEl.value.trim();if(!e)return d.inputEl.placeholder="[error]",void console.error("[error]");d.spinBackEl.classList.remove("visually-hidden"),d.spinEl.classList.remove("visually-hidden"),d.inputEl.placeholder="Type to search...";try{localStorage.clear(),await async function(a){await fetch("/",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({track:a})}).then(a=>a.json()).then(a=>b(a)).catch(a=>console.error(a))}(e)}catch(a){console.error("Search error:",a)}finally{d.spinBackEl.classList.add("visually-hidden"),d.spinEl.classList.add("visually-hidden")}d.formEl.reset()}),d.loginBtn.addEventListener("click",function(){console.log("\uD83D\uDD35 Opening Twitch login...");const a=window.open("/auth/twitch","TwitchAuth","width=600,height=700");if(!a)return void alert("Popup blocked! Please allow popups for this site.");const b=a=>{if(!(console.log("\uD83D\uDD35 Message received:",a.data),a.origin===window.location.origin))console.warn("\u274C Wrong origin:",a.origin);else if("TWITCH_AUTH_SUCCESS"===a.data.type){console.log("\u2705 Auth successful!");const d=a.data.user;localStorage.setItem("_login","true"),localStorage.setItem("_username",d.username),localStorage.setItem("_displayName",d.displayName),localStorage.setItem("_profileImage",d.profileImage),localStorage.setItem("_userId",d.id),console.log("\uD83D\uDCBE Data saved:",d),c(),window.removeEventListener("message",b)}};window.addEventListener("message",b);const d=setInterval(()=>{a.closed&&(console.log("\uD83D\uDD35 Popup closed"),clearInterval(d),window.removeEventListener("message",b))},1e3)}),window.addEventListener("load",c),window.addEventListener("resize",c)})();