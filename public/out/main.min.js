"use strict";(()=>{"use strict";function b(b){null!==b&&f.spinEl.classList.add("visually-hidden");const c=b?.tracks?.items||b?.items||b?.tracks||[];let e=f.listEl;e.innerHTML="",c.forEach(b=>{const c=document.createElement("li"),a=document.createElement("span"),f=document.createElement("img"),g=document.createElement("a");a.classList.add("main__span"),c.classList.add("main__item"),f.classList.add("main__img"),g.classList.add("main__link"),f.src=b.album.images[1]?.url||b.album.images[0]?.url||"",f.alt=b.album.name,g.href=b.external_urls.spotify,g.target="_blank",g.rel="noopener noreferrer nofollow",g.textContent=`${b.name} - ${b.artists[0].name}`,a.textContent="click",e.appendChild(c),g.appendChild(a),c.appendChild(f),c.appendChild(g),(a=>{const b=JSON.parse(localStorage.getItem(d))||[];b.some(b=>b.id===a.id)||(b.push(a),localStorage.setItem(d,JSON.stringify(b)))})(b)})}function c(){const b=localStorage.getItem("_username"),c=localStorage.getItem("_displayName"),d=localStorage.getItem("_profileImage");if(b){const e=document.querySelector(".login-button");e&&(e.textContent=c||b,d&&(e.innerHTML=`\n          <img src="${d}" alt="${b}" style="width: 30px; border-radius: 50%;">\n          <span>${c||b}</span>\n        `))}}async function a(a){if(a.origin===window.location.origin&&"TWITCH_AUTH_SUCCESS"===a.data.type){const{code:b,login:d}=a.data;if(d&&b)try{const a=await fetch("/auth/twitch/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:b})}),d=await a.json();d.username&&(localStorage.setItem("_code",b),localStorage.setItem("_login","true"),localStorage.setItem("_username",d.username),localStorage.setItem("_displayName",d.displayName),localStorage.setItem("_profileImage",d.profileImage),c())}catch(a){console.error("Failed to fetch user data:",a)}}}const d="savedTracks",f={loginTxt:document.querySelector(".nav-auth__text"),formEl:document.querySelector(".nav-form__post"),inputEl:document.querySelector(".nav-form__input"),loginBtn:document.querySelector(".nav-auth__link"),listEl:document.querySelector(".main__list"),spinEl:document.querySelector(".main__spin"),spinBackEl:document.querySelector(".main__spin-backdrop")},e=JSON.parse(localStorage.getItem("savedTracks"))||[];0<e.length&&b({tracks:{items:e}}),f.formEl.addEventListener("submit",async c=>{c.preventDefault();const d=f.inputEl.value.trim();if(!d)return f.inputEl.placeholder="[error]",void console.error("[error]");f.spinBackEl.classList.remove("visually-hidden"),f.spinEl.classList.remove("visually-hidden"),f.inputEl.placeholder="Type to search...";try{localStorage.clear(),await async function(a){await fetch("/",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({track:a})}).then(a=>a.json()).then(a=>b(a)).catch(a=>console.error(a))}(d)}catch(a){console.error("Search error:",a)}finally{f.spinBackEl.classList.add("visually-hidden"),f.spinEl.classList.add("visually-hidden")}f.formEl.reset()}),f.loginBtn.addEventListener("click",function(){const b=window.open("/auth/twitch","TwitchAuth","width=600,height=700");window.addEventListener("message",a,!1);const c=setInterval(()=>{b.closed&&(clearInterval(c),window.removeEventListener("message",a))},1e3)}),window.addEventListener("load",c),window.addEventListener("resize",c)})();