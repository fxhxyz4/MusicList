'use strict';

!(function () {
	'use strict';

	var e = {
		formEl: document.querySelector('.nav-form__post'),
		inputEl: document.querySelector('.nav-form__input'),
		loginBtn: document.querySelector('.nav-auth__link'),
		listEl: document.querySelector('.main__list'),
	};
	const t = JSON.parse('{"a":["After Dark","Freaks","love"]}').a,
		n = btoa('74e32fcef00f4917950e482de83f327d:7d7aece049984959b34744653fcb3d1b');
	console.clear(),
		e.formEl.addEventListener('submit', o => {
			o.preventDefault();
			const a = e.inputEl.value.trim();
			console.log(a),
				'' === a
					? ((e.inputEl.placeholder = '[error]'), console.error('[error]'))
					: ((async function (o) {
							const a = await fetch('https://accounts.spotify.com/api/token', {
									method: 'POST',
									headers: {
										Authorization: 'Basic '.concat(n),
										'Content-Type': 'application/x-www-form-urlencoded',
									},
									body: 'grant_type=client_credentials',
								}),
								l = (await a.json()).access_token;
							try {
								const n = await fetch('https://api.spotify.com/v1/search?type=track&q='.concat(o, '&limit=15'), {
										headers: {
											Authorization: 'Bearer '.concat(l),
										},
									}),
									a = await n.json();
								console.log(a);
								let r = e.listEl;
								(r.innerHTML = ''),
									a.tracks.items.forEach(e => {
										const n = document.createElement('li'),
											o = document.createElement('span'),
											a = document.createElement('img'),
											l = document.createElement('a');
										o.classList.add('main__span'),
											n.classList.add('main__item'),
											a.classList.add('main__img'),
											l.classList.add('main__link'),
											(l.href = e.external_urls.spotify),
											(l.target = '_blank'),
											(l.rel = 'noopener noreferrer nofollow'),
											(l.textContent = ''.concat(e.name, ' - ').concat(e.artists[0].name)),
											(o.textContent = 'click'),
											(a.onload = () => {
												t.includes(e.name) &&
													((n.style.backgroundColor = '#fff'),
													(a.style.opacity = '0'),
													(l.style.opacity = '1'),
													(l.textContent = 'DMCA'),
													(l.style.color = 'red'),
													(l.style.fontSize = '24px'),
													(l.style.padding = '30px'),
													(l.style.fontWeight = '500'));
											}),
											(a.src = e.album.images[1].url),
											(a.alt = e.album.name),
											r.appendChild(n),
											l.appendChild(o),
											n.appendChild(a),
											n.appendChild(l);
									});
							} catch (e) {
								console.error(e);
							}
					  })(a),
					  (e.inputEl.placeholder = 'Type to search...')),
				e.formEl.reset();
		}),
		e.loginBtn.addEventListener('click', () => {
			window.open('/auth/twitch');
		});
})();
